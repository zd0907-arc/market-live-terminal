# V3.0 紧急修复方案：TypeError 页面崩溃

## 1. 问题分析

*   **现象**: 页面加载 3-5 秒后崩溃变白。
*   **报错**: `TypeError: Cannot read properties of undefined (reading 'toString')` at `formatYAxis`.
*   **定位**: 在 `SentimentTrend.tsx` 的 `formatYAxis` 函数中：
    ```typescript
    const formatYAxis = (tick: number) => {
      if (Math.abs(tick) >= 10000) return `${(tick/10000).toFixed(1)}w`;
      return tick.toString(); // 这里报错
    };
    ```
*   **原因**: Recharts 有时会传入 `undefined` 或 `null` 作为 tick 值（特别是在数据更新、domain 自动计算或没有数据点的边缘时刻）。当 `tick` 为 `undefined` 时，调用 `tick.toString()` 就会抛出异常导致 React 渲染树崩溃。

## 2. 解决方案

修改 `formatYAxis` 函数，增加对 `tick` 的类型检查和空值保护。

```typescript
const formatYAxis = (tick: any) => {
  if (tick === undefined || tick === null) return '';
  if (typeof tick !== 'number') return String(tick); // 防止传入非数字
  if (Math.abs(tick) >= 10000) return `${(tick/10000).toFixed(1)}w`;
  return tick.toString();
};
```

## 3. 执行计划

1.  **修改前端代码**: 立即更新 `src/components/dashboard/SentimentTrend.tsx` 中的 `formatYAxis` 函数。
2.  **验证**: 保存后等待前端热重载，确认页面不再崩溃。
