# 散户情绪模块升级计划 (V2.1)

## 1. 界面布局重构 (UI Layout Refactor)
*   **左侧布局调整**: 采用 "左2右1" 的内部网格布局。
    *   **左侧列 (垂直堆叠)**: 放置 **情绪得分** 和 **多空词频比**。这两个卡片将改为正方形（或接近正方形）的紧凑样式。
    *   **右侧列 (占据剩余空间)**: 放置 **AI 舆情摘要**。由于空间变大，将支持显示更多文字内容，并预留给未来真实 LLM 生成的长文本。
*   **信息标浮窗 (Tooltips)**:
    *   在“情绪得分”和“多空词频比”标题旁添加 `HelpCircle` 图标。
    *   悬停显示详细计算逻辑：
        *   *情绪得分*: "基于关键词匹配算法：(多头词数 - 空头词数 * 1.2)，归一化到 -10~10 区间。"
        *   *多空比*: "多头关键词总数 / (空头关键词总数 + 1)。>2.0 为显著看多，<0.5 为显著看空。"

## 2. 配置功能增强 (Configuration)
*   **改造 `ConfigModal.tsx`**: 将现有的弹窗改造为多标签页 (Tabs) 结构。
    *   **Tab 1: 主力判定** (原有功能)。
    *   **Tab 2: 情绪词库**: 提供两个多行文本框 (Textarea)，分别维护“多头关键词”和“空头关键词”，支持逗号分隔。
    *   **Tab 3: AI 设置**: 提供 LLM 配置表单（Base URL, API Key, Model Name）。
*   **后端支持**:
    *   更新 `app_config` 表，存储 `sentiment_bull_words`, `sentiment_bear_words`, `llm_base_url`, `llm_api_key`, `llm_model`。
    *   更新 `sentiment_analyzer.py`，使其在初始化时从数据库加载词库，并支持热更新。

## 3. AI 能力接入 (AI Integration)
*   **后端服务**: 创建 `LLMService`。
    *   在生成摘要时，检查是否配置了 LLM。
    *   如果已配置，将 Top 20 热门评论 + 统计指标投喂给 LLM，生成真实摘要。
    *   如果未配置，回退到目前的规则模板模式。

## 4. 执行步骤
1.  **前端**: 改造 `ConfigModal`，增加 Tab 和新配置项。
2.  **后端**: 更新 `config` 路由以支持新字段的读写。
3.  **后端**: 更新 `SentimentAnalyzer` 以支持动态词库。
4.  **后端**: 实现简易 `LLMService` 并集成到 `sentiment.py`。
5.  **前端**: 重构 `SentimentDashboard.tsx` 的布局和 Tooltip。
