**一、业务需求与设计理解**
您要求实现一套基于“快照差分”的**微观博弈监控系统**。核心在于利用腾讯接口 3 秒一次的快照时间差，计算主力在买一/卖一位置的“手脚”。

1. **冰山压单 (Iceberg)**：监测“吃而不减”的异常，捕捉主力隐形出货。
2. **虚假托单 (Spoofing)**：监测“未成交先撤单”的诱多行为，捕捉主力虚假支撑。
3. **量价背离 (Efficiency)**：监测“量大价不涨/跌不动”的背离，捕捉诱多或吸筹。
   前端只在触发时打标，并提供详细解释。

**二、技术实施方案**

1. **后端开发 (`monitor.py`)**：

   * **状态缓存**：构建 `MarketState` 内存池，存储每只股票的 `prev_snapshot`（上一帧的买一/卖一量、外盘/内盘总量）。

   * **核心算法实现**：严格复用您提供的 Python 伪代码逻辑。

     * `check_iceberg`: `delta_active_buy > 500` 且 `refill` 占比高。

     * `check_spoof`: `delta_active_sell` 小但 `delta_bid1` 大幅减少。

     * `check_efficiency`: `net_flow` 巨大但价格未动。

   * **数据存储**：在 `sentiment_snapshots` 表中新增 `signals` (JSON) 字段，持久化存储触发的报警信号。

2. **前端开发 (`SentimentTrend.tsx`)**：

   * **信号渲染**：在图表（CVD/价格区域）的时间轴上，当检测到 `signals` 不为空时，渲染对应的 **Emoji 图标**（如 🧊、👻、⚠️）。

   * **交互详情**：鼠标悬停在图标上时，显示后端返回的 `detail` 字段（如“外盘吃进1000手，卖一仅减少100手”）。

   * **联合研判**：在标题栏添加 `?` 按钮，展示您提供的“真突破/假支撑”决策矩阵。

   * **文案修正**：修正 OIB Tooltip 为“买一至买五”。

**三、执行计划**

1. **后端**：修改 `monitor.py` 实现三大算法与状态管理，更新 DB Schema。
2. **前端**：修改 `SentimentTrend.tsx` 实现信号打点与 Tooltip 展示。
3. **验证**：通过模拟数据或盘中观察验证报警触发情况。

