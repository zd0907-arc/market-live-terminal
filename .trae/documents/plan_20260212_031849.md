# 实时页面重构与新功能设计计划

您提出了非常清晰的改版需求，我将分两部分为您解答：一是腾讯数据字段详解与仪表盘设计，二是页面重构的具体实施计划。

### 第一部分：腾讯数据与情绪仪表盘设计

#### 1. 腾讯快照接口 (`qt.gtimg.cn`) 核心字段全解
除了基础的价格、涨跌幅外，腾讯接口还提供了以下关键的**博弈类字段**（基于 `v_sh600519="1~..."` 的分割）：

*   **第 7 位：外盘 (Active Buy)** —— 主动买入成交量（手）。
*   **第 8 位：内盘 (Active Sell)** —— 主动卖出成交量（手）。
*   **第 38 位：换手率 (Turnover Rate)** —— 市场活跃度的直接体现。
*   **第 10-19 位：买一至买五**（量/价）。
*   **第 20-29 位：卖一至卖五**（量/价）。
*   **第 6 位：总成交量**。

#### 2. “多空情绪仪表盘”设计逻辑
我们不仅仅展示内外盘的数字，而是要计算出**情绪强度**：

*   **核心指标：委比 (Order Imbalance) 与 内外盘比**
    *   **情绪得分 (Sentiment Score)**：基于 `(外盘 - 内盘) / 总成交量` 计算。
        *   `> 0` 为多头主导（红色），`< 0` 为空头主导（绿色）。
        *   结合**换手率**：换手率高且外盘大，说明是**“放量上攻”**（强多头）；换手率低且外盘大，可能是**“缩量惜售”**。
*   **买卖压力 (Pressure Gauge)**：
    *   利用**买一至买五**和**卖一至卖五**的总挂单量对比。
    *   `委比 = (买盘总量 - 卖盘总量) / (买盘总量 + 卖盘总量)`。
    *   这个指标反映了**潜在的**多空意愿（挂单），而内外盘反映了**实际的**多空成交。

**UI 设计方案 (仪表盘组件)**：
*   **左侧：实战博弈 (Active)** —— 环形图展示 `外盘 vs 内盘` 占比。
    *   中心显示“净主动买入量”。
*   **右侧：潜在意愿 (Passive)** —— 水平对抗条展示 `委买量 vs 委卖量` (五档总和)。
*   **底部：情绪标签** —— 根据上述两个指标综合给出一个标签，如“**强势吸筹**”、“**抛压沉重**”、“**多空平衡**”。

---

### 第二部分：页面重构实施计划

#### 1. 移除旧功能
*   删除 `DataSourceControl` 组件及相关逻辑。
*   `RealtimeView` 顶部硬编码显示 `API Source: Sina (AkShare)`。

#### 2. 布局调整 (Layout Revamp)
*   **Top Row (主力动态)**：
    *   宽度：`col-span-full` (100%)。
    *   高度：保持 300px+。
    *   X 轴：固定 `09:30` 至 `15:00`，不再动态伸缩。
*   **Bottom Row (分左右)**：
    *   **Left (50%) - 新增：情绪仪表盘 (Tencent Sentiment)**：
        *   调用后端新接口（需新增）获取腾讯快照。
        *   展示上述设计的内外盘、委比、情绪标签。
    *   **Right (50%) - 下移：逐笔交易 (Level-1 Ticks)**：
        *   保持现有表格样式，高度适配。

#### 3. 后端开发
*   在 `backend/app/services/market.py` 中封装 `get_tencent_snapshot(symbol)`，解析上述关键字段。
*   在 `backend/app/routers/market.py` (需确认路由文件) 或 `main.py` 增加 `/api/sentiment?symbol=...` 接口。

请批准执行此重构与开发计划。