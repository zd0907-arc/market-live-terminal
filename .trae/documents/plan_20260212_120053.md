## 系统级配置迁移方案

您希望将资金阈值配置提升为系统级全局功能，放置在页面右上角，以便同时控制“实时监控”和“历史复盘”的数据计算标准。

### 1. 前端改造 (Frontend)
*   **移动组件**：将 `ThresholdConfig` 组件从 `RealtimeView.tsx` 移至 `App.tsx` 的顶部 Header 区域（右上角）。
*   **全局状态管理**：
    *   在 `App.tsx` 中引入一个状态 `configVersion`（或类似触发器）。
    *   当 `ThresholdConfig` 保存配置后，更新 `configVersion`。
    *   将 `configVersion` 作为 prop 传递给 `RealtimeView` 和 `HistoryView`，强制它们在配置变更时重新拉取数据。

### 2. 后端逻辑确认 (Backend)
*   **实时数据 (`calculate_realtime_aggregation`)**: 已经在上一步改为动态读取配置，无需修改。
*   **历史数据 (`aggregate_intraday_30m`)**: 代码显示该函数**已经**调用了 `get_app_config()` 读取配置：
    ```python
    config = get_app_config()
    large_th = float(config.get('large_threshold', 200000))
    ```
    因此，只要配置更新，下次执行聚合时就会生效。
    *注意：由于历史数据通常是“一次性写入”的，如果只改配置而不触发重新计算，旧的历史数据（如昨天的）仍然是按旧阈值计算的。为了保证一致性，我会在“保存配置”的操作中，建议后端清除缓存或在前端提示用户（本期先做配置生效，历史数据的即时刷新依赖于后端是否重新聚合，目前后端逻辑是“覆盖写入”，所以如果触发重算即可）。*

### 3. 执行计划
1.  **修改 `App.tsx`**：引入 `ThresholdConfig`，放在 Header 右侧。
2.  **状态传递**：在 `App` 中定义 `handleConfigUpdate`，并传递给子组件。
3.  **清理旧代码**：从 `RealtimeView.tsx` 中移除局部的配置按钮。

这样，无论您在哪个页面，点击右上角的设置，都能统一调整主力/超大单的门槛，并立即看到变化。
