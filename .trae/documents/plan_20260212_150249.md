# 散户情绪模块深度优化计划 (V3.0)

## 1. UI 交互优化 (Dashboard)
*   **信息标浮窗 (Tooltip)**:
    *   **修复**: 将 Tooltip 的 CSS 定位从 `absolute` 改为 `fixed` 或调整 z-index 上下文，确保它能溢出父容器 (`overflow-hidden` 问题修复)，不再被截断。
*   **AI 摘要交互**:
    *   **增加高度**: 左侧“情绪得分+多空比”高度增加，右侧“AI 摘要”高度随之增加，可容纳 5 行+标题。
    *   **独立生成按钮**: 在 AI 摘要区域右上角增加 "AI 总结" 按钮。
        *   *逻辑*: 如果无数据，显示空状态；有数据未生成，点击生成；已生成，显示最新一条，支持再次点击生成。
    *   **历史摘要日志**: 增加 "历史摘要" 弹窗或侧边抽屉，展示该股票过去生成的 AI 总结记录（时间+内容）。

## 2. 后端逻辑升级 (Backend)
*   **爬虫增强 (`sentiment_crawler.py`)**:
    *   **智能回溯**: 抓取时检查数据库中该股票的最早评论时间。
    *   **策略**: 
        *   无数据/数据少于14天 -> 启动**深度抓取模式** (Deep Crawl)，自动翻页直到覆盖 14 天数据。
        *   有近期数据 -> 启动**增量抓取模式** (Incremental Crawl)，只抓取最新页直到遇到已存在的数据。
*   **AI 摘要服务 (`sentiment.py` & DB)**:
    *   **新表**: `sentiment_summaries` (id, symbol, content, created_at, model_used)。
    *   **新接口**:
        *   `POST /api/sentiment/summary/{symbol}`: 触发 AI 生成并存库。
        *   `GET /api/sentiment/summary/history/{symbol}`: 获取历史摘要列表。
*   **趋势数据 (`sentiment.py`)**:
    *   **多维度聚合**: 修改 `/trend/{symbol}` 接口，支持 `interval` 参数。
        *   `72h` (默认): 按小时聚合 (Hourly)。
        *   `14d`: 按天聚合 (Daily)。

## 3. 前端数据展示
*   **评论列表**:
    *   限制展示数量：接口层或前端层限制最多渲染 100 条，避免卡顿。
*   **趋势图切换**:
    *   增加 "72H" / "14天" 切换 Tab，动态请求不同聚合维度的数据。

## 4. 执行步骤
1.  **数据库**: 创建 `sentiment_summaries` 表。
2.  **后端**:
    *   升级爬虫逻辑 (14天回溯)。
    *   实现 AI 摘要的存储与历史查询接口。
    *   升级趋势接口支持按天聚合。
3.  **前端**:
    *   修复 Tooltip 样式。
    *   重构 AI 摘要区域 (按钮 + 历史记录)。
    *   增加趋势图时间维度切换。
    *   限制评论列表展示数量。
