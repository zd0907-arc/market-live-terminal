# 实时功能修复与优化计划

根据您的反馈，我们需要解决以下三个核心问题：

### 1. 多数据源切换失效
*   **问题**：切换数据源（如从默认源切换到备用源）后页面无变化。
*   **原因**：前端 `DataSourceControl` 组件可能只更新了状态，但没有触发重新加载数据的逻辑，或者后端接口并没有真正利用 `source` 参数来切换上游 API。
*   **修复**：
    *   检查前端 `RealtimeView.tsx` 中 `source` 状态的变化是否触发了 `fetchTicks`。
    *   检查后端 `market.py` 中的 `fetch_live_ticks` 是否支持多源（目前看代码似乎只用了 `ak.stock_zh_a_tick_tx_js`，这是新浪源）。
    *   **注意**：实时逐笔数据（L2级）通常只有极少数免费接口可用。如果 AkShare 只提供新浪这一个源，我们需要明确告知用户，或者尝试集成腾讯/东财的快照接口作为降级方案（但快照不是逐笔）。

### 2. 时间区间修正 (全天展示)
*   **问题**：当前图表是动态时间区间（可能只显示最近 N 分钟）。
*   **需求**：固定显示 09:30 - 15:00 的全天数据。
*   **修复**：
    *   修改前端图表组件（可能是 `RealtimeView.tsx` 或其子组件），强制 X 轴的 `domain` 为全天时间段。
    *   确保后端返回的数据包含完整历史，或者前端进行累积存储。

### 3. 恢复刷新控制功能
*   **问题**：自动刷新选择（5s/15s/30s/1min）和手动刷新按钮丢失。
*   **修复**：
    *   在 `RealtimeView.tsx` 的控制栏中重新添加刷新频率下拉框和刷新按钮。
    *   将刷新定时器（`setInterval`）的间隔绑定到这个状态上。

---

**执行步骤**：
1.  **前端 - 刷新控制恢复**：优先在 UI 上把功能入口加回来。
2.  **前端 - 图表时间轴固定**：调整 Recharts 配置，锁定 X 轴范围。
3.  **后端 - 数据源核查**：确认是否有第二个可用的逐笔数据源。如果没有，可能需要隐藏切换功能或改为“线路切换”（如主备代理）。

请批准执行。