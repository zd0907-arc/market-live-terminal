# V3.0 最终修复方案：实时区与价格线

## 1. 问题复盘

1. **右侧实时区缺失**:

   * 原因：`ReferenceDot` 可能因为 X 轴坐标超出当前 `AreaChart` 的 domain 范围而被裁剪，或者因为 `cvd` 设为 `null` 导致坐标计算异常。

   * 对策：确保实时点的数据被正确加入 `data` 数组以撑开 X 轴，同时为 `ReferenceDot` 显式指定坐标，并强制其在顶层渲染。

2. **价格线错误且不明显**:

   * 原因：当前图表只画了 CVD 面积图，根本**没有画价格线**。用户看到的可能是 CVD 的轮廓线被误认为是价格线。

   * 对策：新增一个独立的 Y 轴（右轴）和一条黄色的折线（Line），专门展示股价走势。

## 2. 实施计划

### A. 前端改造 (`src/components/dashboard/SentimentTrend.tsx`)

#### 1. 新增黄色价格线 (Yellow Price Line)

* **双轴系统**:

  * 左轴 (`yAxisId="left"`)：绑定 CVD 数据。

  * 右轴 (`yAxisId="right"`)：绑定 Price 数据，隐藏轴线 (`hide`) 或仅显示刻度，颜色设为黄色。

* **折线组件**:

  * `<Line yAxisId="right" dataKey="price" ... />`

  * 颜色：`#facc15` (Yellow-400)。

  * 线宽：2px。

  * 不显示数据点 (`dot={false}`)，保持平滑。

#### 2. 修复实时区呼吸点 (Active Zone Dot)

* **数据构造优化**:

  * 在 `useMemo` 中，确保实时点 (`liveData`) 被追加到 `data` 数组末尾。

  * **关键点**：实时点的 `cvd` 设为 `null`（断开 CVD 线），但 `price` 必须保留（连接价格线）。

  * 这样，价格线会一直画到最新一秒，而 CVD 面积图停留在上一分钟，CVD 呼吸点悬浮在最右侧。

#### 3. 视觉微调

* **Tooltip**: 增加“股价”项，显示黄色。

## 3. 代码变更预览

```tsx
<AreaChart ...>
    {/* 左轴：CVD */}
    <YAxis yAxisId="left" ... />
    {/* 右轴：价格 (新增) */}
    <YAxis yAxisId="right" orientation="right" domain={['auto', 'auto']} hide />
    
    {/* CVD 面积图 (左轴) */}
    <Area yAxisId="left" dataKey="cvd" ... />
    
    {/* 股价折线图 (右轴, 新增) */}
    <Line yAxisId="right" type="monotone" dataKey="price" stroke="#facc15" strokeWidth={2} dot={false} connectNulls />

    {/* 呼吸点 (强制显示) */}
    {liveData && (
        <ReferenceDot 
            yAxisId="left" // 绑定到 CVD 轴
            x={liveData.timestamp} 
            y={liveData.cvd} 
            isFront={true} // 强制最前
            ... 
        />
    )}
</AreaChart>
```

此方案将完美解决“价格线看不清”和“实时点消失”的问题。
