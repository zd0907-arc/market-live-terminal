# 问题诊断与修复计划

后端日志显示 `/api/ticks_full` 正在被调用（200 OK），这说明前端确实在轮询。
然而，日志中**没有看到** `Saved ... ticks` 的记录（除了最开始的启动日志，但之后似乎没有新的保存记录）。
仔细观察日志：
*   `14:00:56` 启动了 `Data Collector`。
*   `14:02:47` 出现了 `WARNING - Failed to fetch sz300017: '成交金额(元)'`。
*   `14:03:02` 前端再次请求 `ticks_full`，返回 200。

**问题可能出在 `Data Collector` 的异常处理上**：
如果 AkShare 的 API 列名发生了变化（例如某些股票返回的列名不同），可能会导致 `_save_ticks` 抛出异常，从而中断了保存流程，或者没有保存任何数据。
特别注意的是日志里的 `WARNING - Failed to fetch sz300017: '成交金额(元)'`。这说明代码在尝试访问 `row['成交金额(元)']` 时失败了。我在之前的代码里做了兼容（`amt_col = '成交额' if '成交额' in df.columns else '成交金额(元)'`），但看起来还是不够健壮，或者列名又有新花样。

## 修复计划

### 1. 增强 `Data Collector` 的健壮性
*   **打印列名**：当发生 KeyError 时，打印出实际的列名，以便调试。
*   **更灵活的列名匹配**：遍历列名寻找包含 "额" 或 "量" 的字段，而不是硬编码。
*   **确保数据保存**：即使某一只股票失败，也不要影响其他股票。

### 2. 前端 UI 改进
*   **移除旧的刷新控件**：既然是自动同步，下拉菜单已经没用了，直接移除，避免误导。
*   **显式状态提示**：如果 `ticks` 为空，显示 "正在后台同步数据 (约需1-3分钟)..." 而不是空白。
*   **调试信息**：在 "Updated" 旁边暂时显示当前的 tick 数量（例如 `Updated: 14:05:00 (1500 ticks)`），确信数据进来了。

### 3. 立即触发一次全量抓取
*   为了让您马上看到效果，我将在代码修复后重启服务，并让 Collector 在启动时**立即**执行一次，而不是等待 3 分钟。

请稍等，我马上修复代码并重启。