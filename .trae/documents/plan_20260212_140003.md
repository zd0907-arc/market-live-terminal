# 散户情绪模块重构计划 (Retail Sentiment V2.0)

## 1. 架构调整 (Backend Refactor)
*   **目标**: 暴露真实评论数据，而不仅仅是聚合统计。
*   **新增 API**: `GET /api/sentiment/comments/{symbol}`
    *   **参数**: `limit` (默认 50)
    *   **返回**: 包含 `content`, `pub_time`, `read_count`, `reply_count`, `sentiment_score` 的评论列表。
*   **抓取逻辑说明**: 
    *   目前使用 `sentiment_crawler.py` 抓取东方财富股吧首页（最近约 80 条帖子）。
    *   **Crawl Window**: 每次点击“立即抓取”仅抓取当前时刻的首页数据（实时快照）。后台有增量去重逻辑。
    *   **LLM 状态**: 目前是 **Mock (模拟)** 状态。摘要是基于多空比阈值生成的预设文案。计划在未来接入 DeepSeek API。

## 2. 前端重构 (Frontend Refactor)
*   **布局变更**: 从“上下结构”改为“左右结构”。
    *   **左侧 (Left Panel)**: 
        *   **核心指标**: 情绪分、多空比。
        *   **AI 摘要**: 风险提示与总结。
        *   **趋势图**: 缩小高度，仅展示最近 24-72 小时热度趋势。
    *   **右侧 (Right Panel - Scrollable)**: 
        *   **实时评论流**: 新增 `CommentList` 组件。
        *   **展示项**: 用户名(匿名)、时间、评论内容、阅读/回复数。
        *   **样式**: 根据情绪分高亮背景（红色=看多，绿色=看空）。

## 3. 关键词更新方案 (Keyword Strategy)
*   **现状**: 关键词硬编码在 `sentiment_analyzer.py` 中。
*   **方案**: 
    1.  **短期**: 将关键词提取到独立配置文件 `config/sentiment_keywords.json`，方便热更。
    2.  **长期**: 建立“未知高热词发现机制”。定期统计未命中关键词但高热度的帖子，人工或 AI 辅助提取新词（如“跨年妖”、“A杀”等新词）。

## 4. 执行步骤
1.  **后端**: 在 `sentiment.py` 中添加 `get_recent_comments` 接口。
2.  **前端**: 
    *   更新 `sentimentService.ts` 添加 `getComments` 方法。
    *   创建 `CommentList.tsx` 组件。
    *   重构 `SentimentDashboard.tsx` 布局。
3.  **验证**: 抓取测试，确认评论流能否实时显示。
