# V3.0 终极 UI/UX 修正方案

## 1. 核心问题复盘
1.  **UI 对齐问题**：目前的“实时区”只占用了上半部分 (CVD)，导致下半部分 (OIB) 右侧空缺，视觉上没有贯穿对齐。
2.  **异常时间点**：出现了 16:14 的数据点，这是因为后端抓取逻辑没有过滤收盘后的无效数据，或者数据库中残留了脏数据。

## 2. 解决方案

### A. UI 布局重构 (贯穿式实时区)
将整个组件拆分为左右两栏：
*   **左栏 (Flex-1)**：包含垂直排列的两个图表容器 (CVD Chart + OIB Chart)。这两个图表将**不再**各自保留右侧空隙，而是占满左栏。
*   **右栏 (Width: 60px)**：一个独立的高条形容器，**高度撑满父容器** (h-full)，垂直贯穿 CVD 和 OIB 两个区域。
    *   在右栏内部，使用 Flex 布局垂直分配空间，确保实时数据（价格、CVD、OIB）在视觉上分别对应左侧的图表位置。

### B. 数据清洗与时间轴修正
1.  **后端过滤 (`monitor.py`)**: 强制限制入库时间。
    *   **规则**: 仅允许 `09:15 <= time <= 15:05` 的数据入库（放宽 5 分钟以容纳收盘集合竞价）。
2.  **前端过滤 (`SentimentTrend.tsx`)**: 在渲染前再次清洗数据。
    *   **规则**: `filter(t => t >= '09:15' && t <= '15:00')`。
    *   **脏数据处理**: 对于数据库中已存在的 16:xx 数据，前端会将其过滤掉，从而立即修复显示问题。

## 3. 实施计划

### 步骤 1: 布局重写 (`SentimentTrend.tsx`)
```tsx
<div className="flex h-full w-full gap-1">
  {/* 左侧：图表区 (包含 CVD 和 OIB 上下排列) */}
  <div className="flex-1 flex flex-col min-w-0">
     <CVDChartContainer className="flex-1 mb-1" />
     <OIBChartContainer className="flex-1" />
  </div>

  {/* 右侧：贯穿式实时区 */}
  <div className="w-[60px] bg-slate-900/80 rounded-lg border border-slate-700/50 flex flex-col relative overflow-hidden">
     {/* 上半部分：对应 CVD */}
     <div className="flex-1 flex flex-col items-center justify-center border-b border-slate-700/30">
        <RealTimePrice />
        <PulsingDot />
        <RealTimeCVD />
     </div>
     {/* 下半部分：对应 OIB */}
     <div className="flex-1 flex flex-col items-center justify-center">
        <RealTimeOIB />
     </div>
  </div>
</div>
```

### 步骤 2: 数据严格过滤
在前端 `useMemo` 中增加：
```typescript
return historyData.filter(d => {
    // 剔除午休
    if (d.timestamp > '11:30' && d.timestamp < '13:00') return false;
    // 剔除盘前盘后
    if (d.timestamp < '09:15' || d.timestamp > '15:00') return false;
    return true;
});
```

### 步骤 3: 后端加固
修改 `monitor.py`，防止未来再写入 16:xx 的数据。

此方案将彻底解决对齐问题和脏数据干扰。
