# 系统设计与架构说明

## 1. 项目概览
**ZhangData 智能博弈监控系统** 是一个混合架构的金融数据终端，旨在突破浏览器纯前端无法获取历史资金细分数据的限制。通过结合 **React 前端** 与 **Python 后端**，本系统实现了：
- **实时监控**: 对 A 股市场资金流向的逐笔监控。
- **历史回溯**: 深入分析历史资金博弈数据（主力 vs 散户）。
- **跨域数据访问**: 使用 Python 作为代理网关，访问新浪、腾讯、东方财富等多个金融数据源。

## 2. 技术架构

### 2.1 前端 (表现层)
- **核心框架**: React 19, TypeScript, Vite.
- **UI 组件库**: Tailwind CSS, Recharts.
- **主要职责**:
  - **RealtimeView (实时视图)**: 渲染实时交易逐笔和资金流向图表。在前端利用共享逻辑计算核心指标。
  - **HistoryView (历史视图)**: 可视化从后端获取的历史趋势数据。
  - **核心逻辑**: 在 `src/utils/calculator.ts` 中实现了“主力资金”计算算法，确保与后端逻辑同构。

### 2.2 后端 (数据与逻辑层)
- **核心框架**: FastAPI (Python 3.9+).
- **并发模型**: AsyncIO + HTTPX (全异步非阻塞).
- **数据库**: SQLite (通过 SQLAlchemy ORM 管理).
- **主要职责**:
  - **数据代理**: 异步转发外部 API 请求，解决浏览器跨域 (CORS) 问题。
  - **数据持久化**: 存储历史分析结果和用户配置。
  - **复杂计算**: 执行每日资金流向汇总等重计算任务。
  - **单一事实来源 (Source of Truth)**: 管理核心配置阈值（如“大单”的定义）。

### 2.3 目录结构
```text
market-live-terminal/
├── src/                  # 前端源代码
│   ├── components/       # 前端组件
│   │   ├── dashboard/    # 功能视图 (Realtime, History)
│   │   └── ...
│   ├── utils/
│   │   └── calculator.ts # 前后端共享的资金流算法
│   └── App.tsx           # 主应用入口
├── backend/              # 后端应用
│   └── app/
│       ├── main.py       # 启动入口 (Port 8000)
│       ├── routers/      # 异步 API 路由接口
│       ├── services/     # 异步业务逻辑层
│       └── models/       # Pydantic 数据模型
└── docs/                 # 项目文档
```

## 3. 业务逻辑：资金流向分析

### 核心算法
我们将每一笔交易分类，以识别“主力”（机构/大户）的动向。

1.  **主力 (Main Force)**: 单笔交易金额 >= `大单阈值 (Large Threshold)`。
2.  **主力净流入 (Net Inflow)**: `主力买入额` - `主力卖出额`。
3.  **主力活跃度 (Activity Ratio)**: `(主力买入额 + 主力卖出额) / 当日总成交额`。

### 配置策略
- **阈值管理**: 存储在后端数据库中。
- **同步机制**: 前端启动时通过 `/api/config` 接口获取。
- **默认阈值**: 200,000 (20万) 定义为“大单”。
